<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/common.css" />
    <link rel="stylesheet" href="../css/doc.css" />
    <title>Contact author of CI2Go</title>
    <script>
      async function onSubmit(e) {
        e.preventDefault();
        const form = e.target;
        const q = Object.fromEntries(
          (document.location.search || '')
            .replace(/^\?/, '')
            .split('&')
            .map(c => c.split('='))
            .map(c => [c[0], decodeURIComponent(c[1])])
        );
        const { device, version } = q;
        const data = Object.fromEntries(
          Array.from(form.elements)
            .filter(input => !!input.name)
            .map(input => [input.name, input.value]));
        const url = form.action;
        Array.from(form.elements).forEach(input => input.disabled = true)
        const res = await fetch(url, {
          method: 'POST',
          mode: 'cors',
          headers:{
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            ...data,
            device,
            version
          })
        })
        Array.from(form.elements).forEach(input => input.disabled = false)
        if (res.ok) {
          document.getElementById('formWrap').innerHTML = '<div class="thankyou doc"><p class="h1">Thank you.</p></div>'
        }
      }
    </script>
  </head>
  <body>
    <div class="container doc">
      <h1>Contact</h1>
      <p>Please provide feedback</p>
    </div>
    <div class="container" id="formWrap">
      <form action="https://us-central1-ci2go-production.cloudfunctions.net/contact" onsubmit="onSubmit(event)">
        <div class="form-group">
          <label for="subjectInput">Subject</label>
          <input type="text" id="subjectInput" class="form-control" name="subject">
        </div>

        <div class="form-group">
          <label for="nameInput">Name</label>
          <input type="text" id="nameInput" class="form-control" name="name">
        </div>

        <div class="form-group">
          <label for="emailInput">Email address</label>
          <input type="email" id="emailInput" class="form-control" name="email" aria-describedby="emailHelp" required>
          <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
        </div>

        <div class="form-group">
          <label for="messageText">Message</label>
          <textarea required rows="5" id="messageText" class="form-control" name="message"></textarea>
        </div>
        <div class="form-group">
          <input type="submit" value="Submit" class="btn btn-lg btn-block btn-primary">
        </div>
      </form>
    </div>
  </body>
</html>
